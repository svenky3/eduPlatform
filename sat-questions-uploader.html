<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAT Questions Bulk Upload - Firestore</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .status-box {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }

        button:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .success {
            background: #10b981;
        }

        .danger {
            background: #ef4444;
        }

        .warning {
            background: #f59e0b;
        }

        .question-preview {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            max-height: 400px;
            overflow-y: auto;
        }

        .question-item {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 5px;
            border: 1px solid #e5e7eb;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .tag {
            display: inline-block;
            padding: 4px 8px;
            background: #667eea;
            color: white;
            border-radius: 4px;
            font-size: 12px;
            margin-right: 5px;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e5e7eb;
            border-radius: 15px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
        }

        .stat-label {
            margin-top: 5px;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìö SAT Questions Database Manager</h1>
        <p class="subtitle">Bulk upload and manage SAT questions in Firestore</p>

        <div class="status-box" id="statusBox">
            <strong>Status:</strong> <span id="statusText">Initializing...</span>
        </div>

        <div class="stats-grid" id="statsGrid">
            <div class="stat-card">
                <div class="stat-number" id="totalCount">0</div>
                <div class="stat-label">Total Questions</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="mathCount">0</div>
                <div class="stat-label">Math Questions</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="readingCount">0</div>
                <div class="stat-label">Reading Questions</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="writingCount">0</div>
                <div class="stat-label">Writing Questions</div>
            </div>
        </div>

        <div class="button-group">
            <button onclick="signIn()" id="signInBtn">üîê Sign In with Google</button>
            <button onclick="loadExistingQuestions()" id="loadBtn" disabled>üì• Load Existing Questions</button>
            <button onclick="addModule1Questions()" id="addModule1Btn" disabled>‚ûï Add Module 1 Questions</button>
            <button onclick="addModule2Questions()" id="addModule2Btn" disabled>‚ûï Add Module 2 Questions</button>
            <button onclick="clearAllQuestions()" class="danger" id="clearBtn" disabled>üóëÔ∏è Clear All Questions</button>
        </div>

        <div class="progress-bar" id="progressBar" style="display: none;">
            <div class="progress-fill" id="progressFill" style="width: 0%;">0%</div>
        </div>

        <div class="question-preview" id="questionPreview" style="display: none;">
            <h3>Questions Preview:</h3>
            <div id="questionsList"></div>
        </div>
    </div>

    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAv4Z5vAl8knY9RNs_U5VFObU3WKJGuxqg",
            authDomain: "sat-education-platform.firebaseapp.com",
            projectId: "sat-education-platform",
            storageBucket: "sat-education-platform.firebasestorage.app",
            messagingSenderId: "860946166755",
            appId: "1:860946166755:web:58b4d314a3ecae88db26d6",
            measurementId: "G-PHHSDVW875"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        let currentUser = null;

        // Sign In Function
        async function signIn() {
            try {
                const provider = new firebase.auth.GoogleAuthProvider();
                const result = await auth.signInWithPopup(provider);
                currentUser = result.user;
                updateStatus(`Signed in as ${currentUser.email}`, 'success');
                enableButtons(true);
                loadExistingQuestions();
            } catch (error) {
                updateStatus(`Sign in failed: ${error.message}`, 'error');
            }
        }

        // Update status
        function updateStatus(message, type = 'info') {
            const statusText = document.getElementById('statusText');
            statusText.textContent = message;
            
            const statusBox = document.getElementById('statusBox');
            statusBox.style.borderLeftColor = 
                type === 'success' ? '#10b981' : 
                type === 'error' ? '#ef4444' : 
                type === 'warning' ? '#f59e0b' : '#667eea';
        }

        // Enable/Disable buttons
        function enableButtons(enable) {
            document.getElementById('loadBtn').disabled = !enable;
            document.getElementById('addModule1Btn').disabled = !enable;
            document.getElementById('addModule2Btn').disabled = !enable;
            document.getElementById('clearBtn').disabled = !enable;
            document.getElementById('signInBtn').style.display = enable ? 'none' : 'block';
        }

        // Load existing questions
        async function loadExistingQuestions() {
            try {
                updateStatus('Loading questions from database...');
                const snapshot = await db.collection('quizQuestions').get();
                
                const stats = {
                    total: 0,
                    math: 0,
                    reading: 0,
                    writing: 0
                };

                const questions = [];
                snapshot.forEach(doc => {
                    const data = doc.data();
                    questions.push({ id: doc.id, ...data });
                    stats.total++;
                    if (data.subject === 'math') stats.math++;
                    if (data.subject === 'reading') stats.reading++;
                    if (data.subject === 'writing') stats.writing++;
                });

                updateStats(stats);
                displayQuestions(questions.slice(0, 10)); // Show first 10
                updateStatus(`Loaded ${stats.total} questions from database`, 'success');
            } catch (error) {
                updateStatus(`Error loading questions: ${error.message}`, 'error');
            }
        }

        // Update statistics display
        function updateStats(stats) {
            document.getElementById('totalCount').textContent = stats.total || 0;
            document.getElementById('mathCount').textContent = stats.math || 0;
            document.getElementById('readingCount').textContent = stats.reading || 0;
            document.getElementById('writingCount').textContent = stats.writing || 0;
        }

        // Display questions preview
        function displayQuestions(questions) {
            const questionsList = document.getElementById('questionsList');
            const questionPreview = document.getElementById('questionPreview');
            
            if (questions.length === 0) {
                questionsList.innerHTML = '<p>No questions found</p>';
                return;
            }

            questionPreview.style.display = 'block';
            questionsList.innerHTML = questions.map(q => `
                <div class="question-item">
                    <div class="question-header">
                        <div>
                            <span class="tag">${q.subject}</span>
                            <span class="tag">${q.difficulty || 'medium'}</span>
                            <span class="tag">Q${q.questionNumber || 'N/A'}</span>
                        </div>
                    </div>
                    <p><strong>Question:</strong> ${q.question.substring(0, 100)}...</p>
                    <p><strong>Answer:</strong> ${q.options[q.correct]}</p>
                </div>
            `).join('');
        }

        // Module 1 Questions (Sample - you'll add all from your PDF)
        function getModule1Questions() {
            return [
                {
                    subject: 'math',
                    format: 'traditional',
                    difficulty: 'medium',
                    questionNumber: 1,
                    question: 'If f(x + 1) = 7x + 10 for all values of x, what is the value of f(10)?',
                    options: ['46', '70', '32', '73'],
                    correct: 3,
                    explanation: 'Substitute x = 9 into f(x + 1) = 7x + 10 to get f(10) = 7(9) + 10 = 73',
                    tags: ['functions', 'algebra'],
                    module: 1
                },
                {
                    subject: 'math',
                    format: 'traditional',
                    difficulty: 'medium',
                    questionNumber: 2,
                    question: 'The original value of a car is $22,000, and it is estimated that each year the value of the car will depreciate by approximately 8.5% from the previous year. Which type of function best models the relationship between time and the value of the car?',
                    options: ['Linear function whose graph has a positive slope', 'Linear function whose graph has a negative slope', 'Quadratic function', 'Exponential function'],
                    correct: 3,
                    explanation: 'Exponential decay best models depreciation by a constant percentage each year',
                    tags: ['functions', 'exponential', 'word-problems'],
                    module: 1
                },
                {
                    subject: 'math',
                    format: 'traditional',
                    difficulty: 'medium',
                    questionNumber: 3,
                    question: 'A hardcover book has sheets of paper that are each 0.1 millimeter thick and a front cover and a back cover that are each 2 millimeters thick. What is the total thickness, in millimeters, of a book that has n sheets of paper?',
                    options: ['t(n) = 4 + 0.1n', 't(n) = 2 + 0.1n', 't(n) = 0.4 + 0.1n', 't(n) = 0.2 + 0.1n'],
                    correct: 0,
                    explanation: 'Total thickness = 2 covers (2mm each) + n sheets (0.1mm each) = 4 + 0.1n',
                    tags: ['functions', 'linear', 'word-problems'],
                    module: 1
                },
                // Add more questions here from Module 1
            ];
        }

        // Module 2 Questions (Sample - you'll add all from your PDF)  
        function getModule2Questions() {
            return [
                {
                    subject: 'math',
                    format: 'grid-in',
                    difficulty: 'medium',
                    questionNumber: 7,
                    question: 'There are 42 integers in a group. If there are 5 times as many odd integers as there are even integers, how many numbers are even integers?',
                    answer: '7',
                    explanation: 'Let x = even integers. Then 5x = odd integers. Total: x + 5x = 42, so 6x = 42, x = 7',
                    tags: ['algebra', 'word-problems'],
                    module: 2
                },
                // Add more Module 2 questions here
            ];
        }

        // Add Module 1 Questions
        async function addModule1Questions() {
            await addQuestionsToDatabase(getModule1Questions(), 'Module 1');
        }

        // Add Module 2 Questions
        async function addModule2Questions() {
            await addQuestionsToDatabase(getModule2Questions(), 'Module 2');
        }

        // Generic function to add questions to database
        async function addQuestionsToDatabase(questions, moduleName) {
            const progressBar = document.getElementById('progressBar');
            const progressFill = document.getElementById('progressFill');
            
            progressBar.style.display = 'block';
            updateStatus(`Adding ${questions.length} questions from ${moduleName}...`);

            let successCount = 0;
            const batch = db.batch();

            for (let i = 0; i < questions.length; i++) {
                const question = questions[i];
                question.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                question.createdBy = currentUser.email;
                question.isActive = true;

                const docRef = db.collection('quizQuestions').doc();
                batch.set(docRef, question);

                // Update progress
                const progress = Math.round(((i + 1) / questions.length) * 100);
                progressFill.style.width = `${progress}%`;
                progressFill.textContent = `${progress}%`;
            }

            try {
                await batch.commit();
                updateStatus(`Successfully added ${questions.length} questions from ${moduleName}!`, 'success');
                progressBar.style.display = 'none';
                loadExistingQuestions();
            } catch (error) {
                updateStatus(`Error adding questions: ${error.message}`, 'error');
                progressBar.style.display = 'none';
            }
        }

        // Clear all questions
        async function clearAllQuestions() {
            if (!confirm('Are you sure you want to delete ALL questions? This cannot be undone!')) {
                return;
            }

            try {
                updateStatus('Deleting all questions...');
                const snapshot = await db.collection('quizQuestions').get();
                const batch = db.batch();
                
                snapshot.docs.forEach(doc => {
                    batch.delete(doc.ref);
                });

                await batch.commit();
                updateStatus('All questions deleted successfully', 'warning');
                loadExistingQuestions();
            } catch (error) {
                updateStatus(`Error deleting questions: ${error.message}`, 'error');
            }
        }

        // Check auth state on load
        auth.onAuthStateChanged(user => {
            if (user) {
                currentUser = user;
                updateStatus(`Signed in as ${user.email}`, 'success');
                enableButtons(true);
                loadExistingQuestions();
            } else {
                updateStatus('Please sign in to manage questions');
                enableButtons(false);
            }
        });
    </script>
</body>
</html>