<!DOCTYPE html>
<html>
<head>
    <title>Firebase Auth Test</title>
    <style>
        body { 
            font-family: Arial; 
            padding: 40px; 
            text-align: center;
            background: #f0f0f0;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px;
        }
        button:hover {
            background: #764ba2;
        }
        .error {
            color: red;
            margin: 20px 0;
            padding: 15px;
            background: #ffe0e0;
            border-radius: 5px;
        }
        .success {
            color: green;
            margin: 20px 0;
            padding: 15px;
            background: #e0ffe0;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Firebase Auth Debugger</h1>
        <p>Let's find out what's wrong</p>
        
        <button onclick="testConfig()">1. Test Firebase Config</button>
        <button onclick="testAuth()">2. Test Authentication</button>
        <button onclick="checkDomain()">3. Check Domain</button>
        
        <div id="result"></div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAv4Z5vAl8knY9RNs_U5VFObU3WKJGuxqg",
            authDomain: "sat-education-platform.firebaseapp.com",
            projectId: "sat-education-platform",
            storageBucket: "sat-education-platform.appspot.com",
            messagingSenderId: "296721018166",
            appId: "1:296721018166:web:5e96a5e3e37e4fd85c04ae"
        };

        let app, auth, db;
        
        function showResult(message, isError = false) {
            const resultDiv = document.getElementById('result');
            resultDiv.className = isError ? 'error' : 'success';
            resultDiv.innerHTML = message;
        }

        function testConfig() {
            try {
                if (app) {
                    showResult('‚ö†Ô∏è Firebase already initialized', true);
                    return;
                }
                
                app = firebase.initializeApp(firebaseConfig);
                auth = firebase.auth();
                db = firebase.firestore();
                
                showResult('‚úÖ Firebase initialized successfully!<br>Config is working!');
            } catch (error) {
                showResult('‚ùå Firebase Error: ' + error.message, true);
                console.error(error);
            }
        }

        function testAuth() {
            if (!auth) {
                showResult('‚ö†Ô∏è Initialize Firebase first (click button 1)', true);
                return;
            }
            
            showResult('üîÑ Opening Google sign-in...');
            
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider)
                .then(result => {
                    showResult(`‚úÖ Success! Signed in as:<br>${result.user.email}<br><br>
                        <strong>Authentication is working!</strong><br>
                        The issue might be in your sat-prep-v4.html file.`);
                })
                .catch(error => {
                    showResult(`‚ùå Auth Error:<br>
                        Code: ${error.code}<br>
                        Message: ${error.message}<br><br>
                        <strong>Solution:</strong><br>
                        ${getErrorSolution(error.code)}`, true);
                    console.error(error);
                });
        }

        function checkDomain() {
            const domain = window.location.hostname;
            let message = `<strong>Current Domain:</strong> ${domain}<br><br>`;
            
            if (domain === 'svenky3.github.io') {
                message += '‚úÖ Domain looks correct<br>';
                message += 'Make sure this domain is authorized in Firebase Console';
            } else if (domain === 'localhost' || domain === '127.0.0.1') {
                message += '‚ö†Ô∏è Running locally<br>';
                message += 'Make sure "localhost" is in authorized domains';
            } else {
                message += '‚ö†Ô∏è Unexpected domain<br>';
                message += 'Add this domain to Firebase authorized domains';
            }
            
            showResult(message);
        }

        function getErrorSolution(errorCode) {
            const solutions = {
                'auth/popup-blocked': 'Allow popups in your browser for this site',
                'auth/unauthorized-domain': 'Add "svenky3.github.io" to Firebase Console ‚Üí Authentication ‚Üí Settings ‚Üí Authorized domains',
                'auth/invalid-api-key': 'API key is invalid. Check Firebase Console for correct key',
                'auth/operation-not-allowed': 'Enable Google sign-in in Firebase Console ‚Üí Authentication ‚Üí Sign-in method',
                'auth/network-request-failed': 'Check your internet connection'
            };
            
            return solutions[errorCode] || 'Check Firebase Console for more details';
        }

        // Auto-check on load
        window.addEventListener('load', () => {
            console.log('Debug page loaded. Current domain:', window.location.hostname);
        });
    </script>
</body>
</html>