<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAT Prep Platform - Restricted Access</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .auth-screen {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }
        
        .auth-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            max-width: 400px;
            width: 100%;
        }
        
        .access-denied {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            max-width: 500px;
            width: 100%;
            border-left: 5px solid #ff6b6b;
        }
        
        .auth-title {
            font-size: 2.2em;
            color: #667eea;
            margin-bottom: 20px;
            font-weight: 700;
        }
        
        .google-signin-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            background: white;
            border: 2px solid #e0e0e0;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #333;
            font-weight: 600;
            font-size: 1.1em;
            width: 100%;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .google-signin-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            border-color: #667eea;
        }
        
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            display: none;
        }
        
        .dashboard-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        .student-info {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .student-details h2 {
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .logout-btn {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .logout-btn:hover {
            background: #ff5252;
            transform: translateY(-2px);
        }
        
        .quiz-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .quiz-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .quiz-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }
        
        .quiz-title {
            font-size: 1.4em;
            color: #667eea;
            margin-bottom: 15px;
            font-weight: 700;
        }
        
        .quiz-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 5px;
        }
        
        .quiz-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .progress-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        .progress-title {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5em;
            font-weight: 700;
        }
        
        .student-stats {
            display: flex;
            justify-content: space-around;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .stat-item {
            text-align: center;
            padding: 15px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 10px;
            flex: 1;
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }
        
        .stat-label {
            color: #666;
            margin-top: 5px;
        }

        .quiz-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            display: none;
        }
        
        .question {
            margin-bottom: 25px;
            padding: 20px;
            background: rgba(102, 126, 234, 0.05);
            border-radius: 10px;
        }
        
        .question h3 {
            color: #667eea;
            margin-bottom: 15px;
        }
        
        .options {
            display: grid;
            gap: 10px;
        }
        
        .option {
            padding: 12px 15px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .option:hover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }
        
        .option.selected {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }
        
        .submit-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1.1em;
            margin-top: 20px;
            transition: all 0.3s ease;
        }
        
        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .back-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }
        
        .back-btn:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        @media (max-width: 768px) {
            .quiz-grid {
                grid-template-columns: 1fr;
            }
            
            .student-stats {
                flex-direction: column;
                gap: 15px;
            }
            
            .student-info {
                flex-direction: column;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <!-- Authentication Screen -->
    <div id="authScreen" class="auth-screen">
        <div class="auth-container">
            <h1 class="auth-title">🎯 SAT Prep Platform</h1>
            <p style="color: #666; margin-bottom: 30px;">
                Sign in with your authorized Gmail account to access your personalized SAT preparation dashboard.
            </p>
            
            <button class="google-signin-btn" onclick="signInWithGoogle()">
                <svg width="20" height="20" viewBox="0 0 24 24">
                    <path fill="currentColor" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                    <path fill="currentColor" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                    <path fill="currentColor" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                    <path fill="currentColor" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                </svg>
                Sign in with Google
            </button>
            
            <p style="color: #666; font-size: 0.9em; margin-top: 20px;">
                📧 Need access? Contact your instructor to be added to the approved student list.
            </p>
        </div>
    </div>

    <!-- Access Denied Screen -->
    <div id="accessDeniedScreen" class="auth-screen" style="display: none;">
        <div class="access-denied">
            <h1 style="color: #ff6b6b; margin-bottom: 20px;">🚫 Access Denied</h1>
            <h2 style="color: #333; margin-bottom: 20px;">Unauthorized Email Account</h2>
            <p style="color: #666; margin-bottom: 20px; line-height: 1.6;">
                Your email address <strong id="deniedEmail"></strong> is not authorized to access this SAT prep platform.
            </p>
            <p style="color: #666; margin-bottom: 30px; line-height: 1.6;">
                <strong>To gain access:</strong><br>
                📧 Contact your instructor or administrator<br>
                📝 Provide your email address for approval<br>
                ⏰ Wait for confirmation before trying again
            </p>
            <button class="logout-btn" onclick="signOut()">
                Try Different Account
            </button>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div id="mainContainer" class="main-container">
        <div class="dashboard-header">
            <div class="student-info">
                <div class="student-details">
                    <h2 id="studentName">Welcome, Student!</h2>
                    <p id="studentEmail" style="color: #666;"></p>
                </div>
                <button class="logout-btn" onclick="signOut()">Sign Out</button>
            </div>
        </div>

        <div class="quiz-grid">
            <div class="quiz-card">
                <h3 class="quiz-title">📚 Reading Comprehension</h3>
                <p style="color: #666; margin-bottom: 20px;">Test your reading skills with passages and critical analysis questions.</p>
                <button class="quiz-btn" onclick="startQuiz('reading', 'traditional')">Traditional Format</button>
                <button class="quiz-btn" onclick="startQuiz('reading', 'jeopardy')">Jeopardy Style</button>
            </div>

            <div class="quiz-card">
                <h3 class="quiz-title">🧮 Mathematics</h3>
                <p style="color: #666; margin-bottom: 20px;">Practice algebra, geometry, and advanced math concepts.</p>
                <button class="quiz-btn" onclick="startQuiz('math', 'traditional')">Traditional Format</button>
                <button class="quiz-btn" onclick="startQuiz('math', 'jeopardy')">Jeopardy Style</button>
            </div>

            <div class="quiz-card">
                <h3 class="quiz-title">✍️ Writing & Language</h3>
                <p style="color: #666; margin-bottom: 20px;">Improve grammar, style, and writing mechanics.</p>
                <button class="quiz-btn" onclick="startQuiz('writing', 'traditional')">Traditional Format</button>
                <button class="quiz-btn" onclick="startQuiz('writing', 'jeopardy')">Jeopardy Style</button>
            </div>
        </div>

        <div class="progress-section">
            <h3 class="progress-title">📊 Your Progress</h3>
            <div class="student-stats">
                <div class="stat-item">
                    <div class="stat-number" id="totalQuizzes">0</div>
                    <div class="stat-label">Quizzes Completed</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="averageScore">0%</div>
                    <div class="stat-label">Average Score</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="bestScore">0%</div>
                    <div class="stat-label">Best Score</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="currentStreak">0</div>
                    <div class="stat-label">Current Streak</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quiz Container -->
    <div id="quizContainer" class="main-container">
        <div class="quiz-container" id="quizContent">
            <button class="back-btn" onclick="showDashboard()">← Back to Dashboard</button>
            <h2 id="quizTitle">Quiz Title</h2>
            <div id="questionsContainer"></div>
            <button class="submit-btn" onclick="submitQuiz()" style="display: none;" id="submitButton">Submit Quiz</button>
        </div>
    </div>

    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <script>
        // Firebase Configuration - Your Actual Config
        const firebaseConfig = {
            apiKey: "AIzaSyAv4Z5vAl8knY9RNs_U5VFObU3WKJGuxqg",
            authDomain: "sat-education-platform.firebaseapp.com",
            projectId: "sat-education-platform",
            storageBucket: "sat-education-platform.firebasestorage.app",
            messagingSenderId: "860946166755",
            appId: "1:860946166755:web:58b4d314a3ecae88db26d6",
            measurementId: "G-PHHSDVW875"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // 🔐 AUTHORIZED EMAILS - ADD YOUR STUDENTS HERE
        const authorizedEmails = [
            'svenky3@gmail.com',        // Replace with your email
            'student1@school.edu',         // Add your students' emails here
            'student2@gmail.com',          // Add more students as needed
            'teacher@school.edu',          // Add teacher emails
            // Add more authorized emails below
        ];

        let currentUser = null;
        let currentQuiz = null;
        let userAnswers = [];

        // Sample Quiz Data
        const quizData = {
            reading: {
                traditional: [
                    {
                        question: "Based on the passage, what is the main theme?",
                        options: ["Love conquers all", "Technology vs nature", "The importance of education", "Family relationships"],
                        correct: 1
                    },
                    {
                        question: "Which literary device is primarily used in line 15?",
                        options: ["Metaphor", "Simile", "Alliteration", "Personification"],
                        correct: 0
                    }
                ],
                jeopardy: [
                    {
                        question: "This author wrote 'To Kill a Mockingbird'",
                        options: ["Who is Harper Lee?", "Who is Mark Twain?", "Who is John Steinbeck?", "Who is Maya Angelou?"],
                        correct: 0
                    }
                ]
            },
            math: {
                traditional: [
                    {
                        question: "If 3x + 7 = 22, what is the value of x?",
                        options: ["3", "5", "7", "15"],
                        correct: 1
                    },
                    {
                        question: "What is the area of a circle with radius 4?",
                        options: ["8π", "16π", "12π", "4π"],
                        correct: 1
                    }
                ],
                jeopardy: [
                    {
                        question: "This is the value of π rounded to two decimal places",
                        options: ["What is 3.14?", "What is 3.16?", "What is 3.12?", "What is 3.18?"],
                        correct: 0
                    }
                ]
            },
            writing: {
                traditional: [
                    {
                        question: "Which sentence is grammatically correct?",
                        options: [
                            "The student's who studied hard passed the test.",
                            "The students who studied hard passed the test.",
                            "The student's whom studied hard passed the test.",
                            "The students whom studied hard passed the test."
                        ],
                        correct: 1
                    }
                ],
                jeopardy: [
                    {
                        question: "This punctuation mark is used to show possession",
                        options: ["What is an apostrophe?", "What is a comma?", "What is a semicolon?", "What is a colon?"],
                        correct: 0
                    }
                ]
            }
        };

        // Check if user is authorized
        function isAuthorizedUser(email) {
            return authorizedEmails.includes(email.toLowerCase());
        }

        // Authentication state observer
        auth.onAuthStateChanged(async function(user) {
            if (user) {
                console.log('User signed in:', user.email);
                
                // Check if user is authorized
                if (isAuthorizedUser(user.email)) {
                    currentUser = user;
                    showDashboard();
                    await loadUserData();
                } else {
                    console.log('Unauthorized user:', user.email);
                    showAccessDenied(user.email);
                }
            } else {
                console.log('User signed out');
                currentUser = null;
                showAuthScreen();
            }
        });

        function showAuthScreen() {
            document.getElementById('authScreen').style.display = 'flex';
            document.getElementById('accessDeniedScreen').style.display = 'none';
            document.getElementById('mainContainer').style.display = 'none';
            document.getElementById('quizContainer').style.display = 'none';
        }

        function showAccessDenied(email) {
            document.getElementById('deniedEmail').textContent = email;
            document.getElementById('authScreen').style.display = 'none';
            document.getElementById('accessDeniedScreen').style.display = 'flex';
            document.getElementById('mainContainer').style.display = 'none';
            document.getElementById('quizContainer').style.display = 'none';
        }

        function showDashboard() {
            document.getElementById('authScreen').style.display = 'none';
            document.getElementById('accessDeniedScreen').style.display = 'none';
            document.getElementById('mainContainer').style.display = 'block';
            document.getElementById('quizContainer').style.display = 'none';
            
            if (currentUser) {
                document.getElementById('studentName').textContent = `Welcome, ${currentUser.displayName || 'Student'}!`;
                document.getElementById('studentEmail').textContent = currentUser.email;
            }
        }

        async function signInWithGoogle() {
            const provider = new firebase.auth.GoogleAuthProvider();
            try {
                await auth.signInWithPopup(provider);
            } catch (error) {
                console.error('Error signing in:', error);
                alert('Error signing in. Please try again.');
            }
        }

        async function signOut() {
            try {
                await auth.signOut();
            } catch (error) {
                console.error('Error signing out:', error);
            }
        }

        async function loadUserData() {
            if (!currentUser) return;
            
            try {
                const userDoc = await db.collection('students').doc(currentUser.uid).get();
                
                if (userDoc.exists) {
                    const userData = userDoc.data();
                    updateProgressDisplay(userData);
                } else {
                    // Create new user document
                    await db.collection('students').doc(currentUser.uid).set({
                        name: currentUser.displayName || 'Student',
                        email: currentUser.email,
                        joinDate: firebase.firestore.FieldValue.serverTimestamp(),
                        totalQuizzes: 0,
                        totalScore: 0,
                        bestScore: 0,
                        currentStreak: 0
                    });
                }
            } catch (error) {
                console.error('Error loading user data:', error);
            }
        }

        function updateProgressDisplay(userData) {
            document.getElementById('totalQuizzes').textContent = userData.totalQuizzes || 0;
            document.getElementById('averageScore').textContent = userData.totalQuizzes > 0 ? 
                Math.round((userData.totalScore || 0) / userData.totalQuizzes) + '%' : '0%';
            document.getElementById('bestScore').textContent = (userData.bestScore || 0) + '%';
            document.getElementById('currentStreak').textContent = userData.currentStreak || 0;
        }

        function startQuiz(subject, format) {
            const quiz = quizData[subject][format];
            if (!quiz) {
                alert('Quiz not available yet.');
                return;
            }
            
            currentQuiz = {
                subject,
                format,
                questions: quiz,
                startTime: Date.now()
            };
            
            userAnswers = new Array(quiz.length).fill(null);
            displayQuiz();
        }

        function displayQuiz() {
            console.log('Starting displayQuiz function');
            console.log('Current quiz:', currentQuiz);
            
            // Hide dashboard and show quiz container
            document.getElementById('mainContainer').style.display = 'none';
            document.getElementById('quizContainer').style.display = 'block';
            
            // Set quiz title
            const title = `${currentQuiz.subject.charAt(0).toUpperCase() + currentQuiz.subject.slice(1)} - ${currentQuiz.format.charAt(0).toUpperCase() + currentQuiz.format.slice(1)} Format`;
            document.getElementById('quizTitle').textContent = title;
            console.log('Quiz title set:', title);
            
            // Get questions container
            const container = document.getElementById('questionsContainer');
            if (!container) {
                console.error('Questions container not found!');
                return;
            }
            
            container.innerHTML = '';
            console.log('Questions to display:', currentQuiz.questions);
            
            // Generate questions
            if (!currentQuiz.questions || currentQuiz.questions.length === 0) {
                console.error('No questions found in quiz data');
                container.innerHTML = '<p style="color: white; text-align: center; padding: 20px;">No questions available for this quiz.</p>';
                return;
            }
            
            currentQuiz.questions.forEach((q, index) => {
                console.log(`Creating question ${index + 1}:`, q);
                
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question';
                questionDiv.innerHTML = `
                    <h3>Question ${index + 1}:</h3>
                    <p>${q.question}</p>
                    <div class="options">
                        ${q.options.map((option, optIndex) => `
                            <div class="option" onclick="selectAnswer(${index}, ${optIndex})">
                                ${option}
                            </div>
                        `).join('')}
                    </div>
                `;
                container.appendChild(questionDiv);
            });
            
            // Show submit button
            const submitBtn = document.getElementById('submitButton');
            if (submitBtn) {
                submitBtn.style.display = 'block';
            }
            
            console.log('Quiz display completed');
        }

        function selectAnswer(questionIndex, optionIndex) {
            userAnswers[questionIndex] = optionIndex;
            
            const questionDiv = document.querySelectorAll('.question')[questionIndex];
            const options = questionDiv.querySelectorAll('.option');
            options.forEach(opt => opt.classList.remove('selected'));
            options[optionIndex].classList.add('selected');
        }

        async function submitQuiz() {
            if (userAnswers.includes(null)) {
                alert('Please answer all questions before submitting.');
                return;
            }
            
            let correct = 0;
            currentQuiz.questions.forEach((q, index) => {
                if (userAnswers[index] === q.correct) {
                    correct++;
                }
            });
            
            const score = Math.round((correct / currentQuiz.questions.length) * 100);
            const timeSpent = Math.round((Date.now() - currentQuiz.startTime) / 1000);
            
            // Save quiz result
            try {
                await db.collection('quizResults').add({
                    studentId: currentUser.uid,
                    subject: currentQuiz.subject,
                    format: currentQuiz.format,
                    score: score,
                    correct: correct,
                    total: currentQuiz.questions.length,
                    timeSpent: timeSpent,
                    answers: userAnswers,
                    completedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // Update user stats
                const userRef = db.collection('students').doc(currentUser.uid);
                const userDoc = await userRef.get();
                const userData = userDoc.data();
                
                const newTotalQuizzes = (userData.totalQuizzes || 0) + 1;
                const newTotalScore = (userData.totalScore || 0) + score;
                const newBestScore = Math.max(userData.bestScore || 0, score);
                const newStreak = score >= 80 ? (userData.currentStreak || 0) + 1 : 0;
                
                await userRef.update({
                    totalQuizzes: newTotalQuizzes,
                    totalScore: newTotalScore,
                    bestScore: newBestScore,
                    currentStreak: newStreak,
                    lastQuizDate: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                alert(`Quiz completed! You scored ${score}% (${correct}/${currentQuiz.questions.length})`);
                showDashboard();
                await loadUserData();
                
            } catch (error) {
                console.error('Error saving quiz result:', error);
                alert('Quiz completed but there was an error saving your result.');
            }
        }

        // Initialize on page load
        window.addEventListener('load', function() {
            showAuthScreen();
        });
    </script>
</body>
</html>
